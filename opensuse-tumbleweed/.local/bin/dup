#!/bin/bash

# vars
ZYPPER_PARAMS_QUIET="--non-interactive --quiet"
ZYPPER_PARAMS_DUP="--no-allow-vendor-change --auto-agree-with-licenses --no-recommends"
FLATPAK_PARAMS_QUIET="--noninteractive --assumeyes"

# stop packagekit while we are running cli ops
if systemctl list-unit-files packagekit.service &>/dev/null; then
    sudo systemctl stop --now packagekit
fi

sudo zypper $ZYPPER_PARAMS_QUIET --gpg-auto-import-keys refresh
sudo zypper $ZYPPER_PARAMS_QUIET dist-upgrade $ZYPPER_PARAMS_DUP
flatpak update $FLATPAK_PARAMS_QUIET

# start packagekit
if systemctl list-unit-files packagekit.service &>/dev/null; then
    sudo systemctl start --now packagekit
fi
